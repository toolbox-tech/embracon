# üîÑ Guia Git Rebase - Embracon Toolbox

## üìö √çndice
1. [O que √© Git Rebase](#-o-que-√©-git-rebase)
2. [Quando usar Rebase](#-quando-usar-rebase)
3. [Passo a Passo Completo](#-passo-a-passo-completo)
4. [Comandos Essenciais](#-comandos-essenciais)
5. [Resolvendo Conflitos](#-resolvendo-conflitos)
6. [Boas Pr√°ticas](#-boas-pr√°ticas)
7. [Troubleshooting](#-troubleshooting)

---

## üéØ O que √© Git Rebase?

O **Git Rebase** √© uma opera√ß√£o que **reorganiza o hist√≥rico** dos commits, "puxando" seus commits para tr√°s no tempo e **reaplicando** eles em cima de uma base atualizada, mantendo a **ordem cronol√≥gica correta**.

### üïí **Analogia: Reorganiza√ß√£o Cronol√≥gica**

Imagine uma **fila de eventos** onde o rebase "puxa" seus eventos para o **final da fila**:

#### **Antes do Rebase (Bagun√ßado):**
```
Timeline do Reposit√≥rio:
Jan: A (main)
Feb: X (sua feature) ‚ùå Fora de ordem!
Mar: B (main)  
Apr: Y (sua feature) ‚ùå Fora de ordem!
Mai: C, D, E, F, G (main - commits novos)
```

#### **Depois do Rebase (Cronol√≥gico):**
```
Timeline do Reposit√≥rio:
Jan: A (main)
Mar: B (main)
Mai: C, D, E, F, G (main - todos os commits)
Ago: X' (sua feature) ‚úÖ Na ordem certa!
Ago: Y' (sua feature) ‚úÖ Na ordem certa!
```

### üìä **Visualiza√ß√£o Gr√°fica**

#### **Estado Inicial:**
```
main:     A---B---C---D---E---F---G (17 commits novos)
          |
feature:  X---Y (seus 2 commits)
```

#### **Ap√≥s Rebase:**
```
main:     A---B---C---D---E---F---G
                                  |
feature:                          X'---Y' (reaplicados cronologicamente)
```

---

## üéØ Quando usar Rebase?

### ‚úÖ **USE Rebase quando:**

#### **1. Sincronizar branch com main**
```bash
# Cen√°rio: Sua branch est√° atrasada
# Status: "This branch is X commits behind main"
git rebase origin/main
```

#### **2. Hist√≥rico limpo**
```bash
# Voc√™ quer um hist√≥rico linear e organizado
# Sem commits de merge desnecess√°rios
```

#### **3. Preparar Pull Request**
```bash
# Antes de abrir PR, organize seus commits
# Facilita o review
```

#### **4. Branch pessoal**
```bash
# Voc√™ √© o √∫nico trabalhando na branch
# Seguro fazer rewrite do hist√≥rico
```

### ‚ùå **N√ÉO use Rebase quando:**

#### **1. Branch compartilhada**
```bash
# Outras pessoas trabalham na mesma branch
# Rebase + force push pode causar problemas
```

#### **2. Commits j√° na main**
```bash
# Commits j√° foram mergeados para main
# NUNCA rebase commits p√∫blicos
```

#### **3. Muitos conflitos**
```bash
# Se houver conflitos complexos
# Merge pode ser mais simples
```

---

## üöÄ Passo a Passo Completo

### **Cen√°rio Comum: Branch atrasada**
```
Status: "This branch is 2 commits ahead of, 17 commits behind main"
```

### **Passo 1: Verificar status atual**
```bash
# Ver branches dispon√≠veis
git branch -a

# Ver status da branch atual
git status

# Ver commits √∫nicos da sua branch
git log --oneline main..HEAD
```

### **Passo 2: Buscar atualiza√ß√µes (OBRIGAT√ìRIO)**
```bash
# Baixar informa√ß√µes mais recentes do servidor
git fetch origin main
```

#### **Por que o fetch √© obrigat√≥rio?**
- ‚úÖ **Atualiza** informa√ß√µes locais sobre a main
- ‚úÖ **N√£o modifica** sua branch ainda
- ‚úÖ **Garante** que o rebase ser√° feito na vers√£o atual

#### **‚ùå Sem fetch:**
```bash
git rebase origin/main  # USA VERS√ÉO ANTIGA!
```

#### **‚úÖ Com fetch:**
```bash
git fetch origin main   # Atualiza informa√ß√µes
git rebase origin/main  # USA VERS√ÉO ATUAL!
```

### **Passo 3: Executar o Rebase**
```bash
# Reaplica seus commits em cima da main atualizada
git rebase origin/main
```

#### **O que acontece internamente:**
1. **Salva** seus commits temporariamente
2. **Reseta** sua branch para origin/main
3. **Reaplica** cada commit seu, um por vez
4. **Cria novos** commit IDs (X', Y')

### **Passo 4: Push com seguran√ßa**
```bash
# Force push com verifica√ß√£o de seguran√ßa
git push --force-with-lease origin feature/sua-branch
```

#### **Por que `--force-with-lease`?**
- ‚úÖ **Mais seguro** que `--force`
- ‚úÖ **Verifica** se ningu√©m fez push antes
- ‚úÖ **Previne** sobrescrever trabalho de outros

---

## ‚ö° Comandos Essenciais

### **Sequ√™ncia Padr√£o:**
```bash
# 1. Verificar status
git status
git log --oneline main..HEAD

# 2. Buscar atualiza√ß√µes (OBRIGAT√ìRIO)
git fetch origin main

# 3. Executar rebase
git rebase origin/main

# 4. Push seguro
git push --force-with-lease origin sua-branch
```

### **Comando Compacto:**
```bash
# Faz fetch + rebase em um comando
git pull --rebase origin main

# Depois push
git push --force-with-lease origin sua-branch
```

### **Verifica√ß√£o ap√≥s rebase:**
```bash
# Ver hist√≥rico reorganizado
git log --oneline --graph -10

# Comparar com main
git log --oneline main..HEAD
```

---

## üö® Resolvendo Conflitos

### **Quando acontecem conflitos:**
```bash
git rebase origin/main

# Output:
# Auto-merging arquivo.txt
# CONFLICT (content): Merge conflict in arquivo.txt
# Resolve all conflicts manually, mark them as resolved with
# "git add/rm <conflicted_files>", then run "git rebase --continue".
```

### **Processo de resolu√ß√£o:**

#### **1. Identificar arquivos com conflito:**
```bash
# Ver arquivos com conflito
git status

# Arquivos marcados como "both modified"
```

#### **2. Editar arquivos manualmente:**
```bash
# Abrir arquivo no editor
code arquivo-com-conflito.txt
```

**Formato dos conflitos:**
```
<<<<<<< HEAD (vers√£o da main)
c√≥digo da main
=======
c√≥digo da sua branch
>>>>>>> commit-message (sua vers√£o)
```

**Resolver:**
- Escolher uma vers√£o
- Ou combinar ambas
- Remover marcadores `<<<<<<<`, `=======`, `>>>>>>>`

#### **3. Marcar como resolvido:**
```bash
# Adicionar arquivos resolvidos
git add arquivo-resolvido.txt

# Continuar o rebase
git rebase --continue
```

#### **4. Se necess√°rio, cancelar:**
```bash
# Abortar o rebase e voltar ao estado anterior
git rebase --abort
```

### **Exemplo pr√°tico de resolu√ß√£o:**

#### **Conflito:**
```javascript
<<<<<<< HEAD
const apiUrl = 'https://api.prod.embracon.com';
=======
const apiUrl = 'https://api.dev.embracon.com';
>>>>>>> feat: update api endpoint
```

#### **Resolu√ß√£o:**
```javascript
const apiUrl = 'https://api.prod.embracon.com';  // Manter vers√£o da main
```

#### **Finalizar:**
```bash
git add config.js
git rebase --continue
```

---

## üéØ Boas Pr√°ticas

### **‚úÖ DOs (Fa√ßa):**

#### **1. Sempre fetch antes:**
```bash
git fetch origin main
git rebase origin/main
```

#### **2. Use --force-with-lease:**
```bash
git push --force-with-lease origin feature/branch
```

#### **3. Teste branch local:**
```bash
# Teste se tudo funciona ap√≥s rebase
npm test
npm run build
```

#### **4. Commits pequenos e organizados:**
```bash
# Facilita resolu√ß√£o de conflitos
# Um commit = uma funcionalidade
```

#### **5. Rebase interativo para organizar:**
```bash
# Reorganizar √∫ltimos 3 commits
git rebase -i HEAD~3

# Op√ß√µes: pick, squash, reword, drop
```

### **‚ùå DON'Ts (N√£o fa√ßa):**

#### **1. Rebase de branch compartilhada:**
```bash
# ‚ùå Se outros trabalham na branch
# Pode causar perda de trabalho
```

#### **2. Force push sem verifica√ß√£o:**
```bash
# ‚ùå PERIGOSO
git push --force origin branch

# ‚úÖ SEGURO  
git push --force-with-lease origin branch
```

#### **3. Rebase de commits p√∫blicos:**
```bash
# ‚ùå NUNCA rebase commits que j√° est√£o na main
# Pode quebrar hist√≥rico para toda equipe
```

#### **4. Rebase com mudan√ßas n√£o commitadas:**
```bash
# ‚ùå Primeiro commitar ou stash
git status  # Deve estar limpo

# ‚úÖ Limpar working directory primeiro
git add .
git commit -m "WIP: salvando progresso"
# ou
git stash push -m "WIP: mudan√ßas tempor√°rias"
```

---

## üõ†Ô∏è Troubleshooting

### **‚ùå Problema: "Cannot rebase: You have unstaged changes"**

#### **Causa:**
Arquivos modificados n√£o commitados

#### **Solu√ß√£o:**
```bash
# Op√ß√£o 1: Committar mudan√ßas
git add .
git commit -m "WIP: progresso atual"
git rebase origin/main

# Op√ß√£o 2: Usar stash
git stash push -m "WIP: mudan√ßas tempor√°rias"
git rebase origin/main
git stash pop
```

### **‚ùå Problema: "No such remote 'origin'"**

#### **Causa:**
Remote n√£o configurado

#### **Solu√ß√£o:**
```bash
# Ver remotes configurados
git remote -v

# Adicionar remote se necess√°rio
git remote add origin https://github.com/user/repo.git
```

### **‚ùå Problema: Muitos conflitos**

#### **Causa:**
Branches muito divergentes

#### **Solu√ß√£o 1: Cancelar e usar merge**
```bash
git rebase --abort
git merge origin/main
```

#### **Solu√ß√£o 2: Rebase em etapas**
```bash
# Rebase por partes
git rebase origin/main~10  # √öltimos 10 commits
# Resolver conflitos
git rebase origin/main~5   # Pr√≥ximos 5
# Resolver conflitos  
git rebase origin/main     # Restante
```

### **‚ùå Problema: "refusing to pull with rebase"**

#### **Causa:**
Configura√ß√£o local conflitante

#### **Solu√ß√£o:**
```bash
# Configurar para branch espec√≠fica
git config branch.feature/k8s.rebase true

# Ou global para todas as branches
git config --global pull.rebase true
```

### **‚ùå Problema: Push rejeitado ap√≥s rebase**

#### **Causa:**
Hist√≥rico foi reescrito

#### **Solu√ß√£o:**
```bash
# Usar force-with-lease (SEGURO)
git push --force-with-lease origin feature/branch

# ‚ö†Ô∏è  CUIDADO: S√≥ se voc√™ tem certeza de que √© sua branch
```

---

## üìã Cheat Sheet de Comandos

### **Workflow Completo:**
```bash
# 1. Prepara√ß√£o
git status                           # Verificar se est√° limpo
git fetch origin main                # Buscar atualiza√ß√µes

# 2. Rebase
git rebase origin/main               # Reorganizar commits

# 3. Se houver conflitos
git status                           # Ver arquivos conflitantes
# Editar arquivos manualmente
git add arquivo-resolvido.txt        # Marcar como resolvido
git rebase --continue                # Continuar

# 4. Finalizar
git push --force-with-lease origin branch  # Push seguro
```

### **Comandos de emerg√™ncia:**
```bash
# Cancelar rebase em andamento
git rebase --abort

# Ver hist√≥rico gr√°fico
git log --oneline --graph -10

# Comparar branches
git log --oneline main..HEAD        # Seus commits √∫nicos
git log --oneline HEAD..main        # Commits s√≥ na main

# Verificar diverg√™ncia
git status
git branch -vv                       # Ver tracking branches
```

### **Configura√ß√µes √∫teis:**
```bash
# Configurar pull com rebase por padr√£o
git config --global pull.rebase true

# Configurar push com verifica√ß√£o
git config --global push.default simple

# Configurar editor para rebase interativo
git config --global core.editor "code --wait"
```

---

## üéØ Cen√°rios Pr√°ticos

### **Cen√°rio 1: Branch pessoal atrasada**
```bash
# Situa√ß√£o: "2 commits ahead, 17 commits behind"
git fetch origin main
git rebase origin/main
git push --force-with-lease origin feature/minha-branch
```

### **Cen√°rio 2: Organizar commits antes do PR**
```bash
# Combinar √∫ltimos 3 commits em 1
git rebase -i HEAD~3
# Escolher: pick, squash, reword, drop
git push --force-with-lease origin feature/branch
```

### **Cen√°rio 3: Atualizar branch de longa dura√ß√£o**
```bash
# Branch com 1 m√™s de atraso
git fetch origin main
git rebase origin/main
# Resolver conflitos conforme aparecem
git push --force-with-lease origin feature/branch
```

### **Cen√°rio 4: Emerg√™ncia - desfazer rebase**
```bash
# Se deu algo errado
git reflog                           # Ver hist√≥rico de opera√ß√µes
git reset --hard HEAD@{n}           # Voltar para estado anterior
# onde n √© o n√∫mero da opera√ß√£o antes do rebase
```

---

## üèÜ Resumo Executivo

### **üéØ O que √© Rebase:**
> "Reorganiza√ß√£o cronol√≥gica que puxa seus commits para tr√°s no tempo e os reaplica em cima de uma base atualizada"

### **üîë Sequ√™ncia Essencial:**
1. **`git fetch origin main`** - Atualizar informa√ß√µes
2. **`git rebase origin/main`** - Reorganizar commits  
3. **`git push --force-with-lease origin branch`** - Enviar resultado

### **‚úÖ Vantagens:**
- Hist√≥rico linear e limpo
- Sem commits de merge desnecess√°rios
- Commits aparecem em ordem cronol√≥gica
- Pull Request mais f√°cil de revisar

### **‚ö†Ô∏è Cuidados:**
- Sempre fetch antes do rebase
- Usar --force-with-lease no push
- N√£o rebase branches compartilhadas
- Nunca rebase commits p√∫blicos

### **üö® Regra de Ouro:**
> "Se voc√™ √© o √∫nico trabalhando na branch, rebase √© seguro. Se outros tamb√©m trabalham, use merge."

---

üéâ **Com esta documenta√ß√£o, voc√™ est√° pronto para usar Git Rebase com seguran√ßa e efici√™ncia na Embracon!**
